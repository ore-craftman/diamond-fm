(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[30],{433:function(e,t,a){"use strict";a.r(t);var n=a(70),c=a(39),s=a(111),r=a.n(s),o=(a(121),a(0)),i=a(51),l=a(46),j=a(44),d=a(52),u=a(45),b=a(19),p=a(123),m=a.n(p),h=(a(122),a(1)),O=a(43);t.default=function(){var e="";document.cookie.split(";").forEach((function(t){var a=t.split("=");"uid"===a[0]&&(e=a[1])}));var t=Object(o.useState)(null),a=Object(c.a)(t,2),s=a[0],p=a[1];Object(o.useEffect)((function(){O.get("/users/".concat(e)).then((function(e){p((function(){return e.data.user}))}))}),[e]);var g=Object(o.useState)(!1),x=Object(c.a)(g,2),f=x[0],v=x[1],y=Object(o.useState)(""),w=Object(c.a)(y,2),N=w[0],C=w[1],S=Object(o.useState)(""),P=Object(c.a)(S,2),I=P[0],L=P[1],D=Object(o.useState)(""),k=Object(c.a)(D,2),T=k[0],G=k[1],F=Object(o.useState)(""),q=Object(c.a)(F,2),A=q[0],B=q[1],E=Object(o.useState)(""),_=Object(c.a)(E,2),J=_[0],z=_[1],M=Object(o.useState)(new Date),H=Object(c.a)(M,2),K=H[0],Q=H[1],R=Object(o.useState)(!1),U=Object(c.a)(R,2),V=U[0],W=U[1],X=Object(o.useState)(!1),Y=Object(c.a)(X,2),Z=Y[0],$=Y[1],ee=Object(o.useState)(null),te=Object(c.a)(ee,2),ae=te[0],ne=te[1],ce=Object(o.useState)(null),se=Object(c.a)(ce,2),re=se[0],oe=se[1],ie=Object(o.useState)(""),le=Object(c.a)(ie,2),je=le[0],de=le[1],ue=Object(o.useState)(!1),be=Object(c.a)(ue,2),pe=be[0],me=be[1];return s&&!s.canPublish&&ae&&O.get("/users/").then((function(e){e.data.users.filter((function(e){return"admin"===e.role})).forEach((function(e){var t={id:e._id,notifications:[].concat(Object(n.a)(e.notifications),[{type:"Pending post",body:ae.featuredDesc.slice(0,25)}])};O.post("/users/notify",t).then((function(e){return console.log(e.data)})).catch((function(e){return console.log(e)}))}))})).catch((function(e){console.log(e)})),Object(h.jsxs)("div",{className:"bg-white px-1 py-4 me-md-2 my-4",children:[ae&&s.canPublish&&Object(h.jsxs)(u.a,{variant:"success",className:"my-2",children:["Post Published"," ",Object(h.jsx)(u.a.Link,{href:"/posts/".concat(ae._id),children:"Click here to view"})]}),ae&&!s.canPublish&&Object(h.jsx)(u.a,{variant:"warning",className:"my-2",children:"Post pending review, you'll be notified when approved by admin"}),!ae&&re&&Object(h.jsx)(u.a,{variant:"danger",className:"my-2",children:re}),!ae&&Object(h.jsxs)("div",{children:[Object(h.jsx)("h4",{children:"New Post"}),Object(h.jsxs)(i.a,{onSubmit:function(e){if(e.preventDefault(),v(!0),""===A||""===T)v(!1),W(!0),$(!0);else if("jpg"===T.name.split(".")[1].toLowerCase()||"jpeg"===T.name.split(".")[1].toLowerCase()||"png"===T.name.split(".")[1].toLowerCase()){var t=new FormData;t.append("featuredImage",T),t.append("title",N),t.append("type",I),t.append("body",A),t.append("audio",""!==J?J:null),t.append("createdBy",s._id),t.append("featuredDesc",je),t.append("pending",!0!==s.canPublish),t.append("programmeDate",""!==K?K:null);O.post("/posts/create",t,{headers:{"content-type":"multipart/form-data"}}).then((function(e){e.data&&e.data.status?ne(e.data.post):(oe(e.data.message?e.data.message:"Oops.. network error"),v(!1))})).catch((function(e){console.log(e)}))}else me(!0),v(!1),console.log("NOT IMG",T.name.split(".")[1].toLowerCase())},name:"postForm",children:[Object(h.jsxs)(l.a,{children:[Object(h.jsx)(j.a,{xs:8,children:Object(h.jsx)(i.a.Group,{controlId:"postTitle",children:Object(h.jsx)(i.a.Control,{type:"text",placeholder:"Add Title",required:!0,value:N,name:"postTitle",onChange:function(e){return C(e.target.value)}})})}),Object(h.jsx)(j.a,{children:Object(h.jsx)(i.a.Group,{controlId:"postType",children:Object(h.jsxs)(i.a.Select,{onChange:function(e){return L(e.target.value)},required:!0,value:I,name:"postType",children:[Object(h.jsx)("option",{value:"",children:"Select Post Type"}),Object(h.jsx)("option",{value:"news",children:"News"}),Object(h.jsx)("option",{value:"blog",children:"Blog"}),Object(h.jsx)("option",{value:"sport",children:"Sport"}),Object(h.jsx)("option",{value:"airProgramme",children:"Air Programme"})]})})})]}),"airProgramme"===I&&Object(h.jsxs)(l.a,{className:"mt-4",children:[Object(h.jsx)(j.a,{children:Object(h.jsxs)(i.a.Group,{controlId:"programmeDate",className:"mb-3",children:[Object(h.jsx)(i.a.Label,{children:"Select Programme Date"}),Object(h.jsx)(m.a,{selected:K,name:"programmeDate",onChange:function(e){return Q(e)},showTimeSelect:!0,timeIntervals:10,dateFormat:"Pp",className:"form-control"})]})}),Object(h.jsx)(j.a,{children:Object(h.jsxs)(i.a.Group,{controlId:"audioLink",className:"mb-3",children:[Object(h.jsx)(i.a.Label,{children:"Audio Link"}),Object(h.jsx)(i.a.Control,{type:"text",placeholder:"https://streams.radiomast.io/...",required:!0,onChange:function(e){return z(e.target.value)},name:"audioLink",value:J})]})})]}),Object(h.jsxs)(l.a,{className:"my-3",children:[Object(h.jsx)(j.a,{children:Object(h.jsxs)(i.a.Group,{controlId:"featuredImage",className:"mb-3",children:[Object(h.jsx)(i.a.Label,{children:"Featured Desc"}),Object(h.jsx)(i.a.Control,{type:"text",placeholder:"Post description",required:!0,value:je,name:"featuredDesc",onChange:function(e){return de(e.target.value)}})]})}),Object(h.jsxs)(j.a,{children:[Object(h.jsxs)(i.a.Group,{controlId:"featuredImage",className:"mb-3",children:[Object(h.jsx)(i.a.Label,{children:"Featured Image"}),Object(h.jsx)(i.a.Control,{type:"file",name:"featuredImage",accept:"image/png,image/jpeg",onChange:function(e){return G(e.target.files[0])}})]}),Z&&Object(h.jsx)(u.a,{variant:"danger",className:"m-1",children:"Choose featured Image"}),pe&&Object(h.jsx)(u.a,{variant:"danger",className:"my-2",children:"featured Image should be jpg, jpeg or png"})]})]}),Object(h.jsxs)(l.a,{className:"my-4 p",children:[Object(h.jsx)(r.a,{theme:"snow",placeholder:"Post Content... start writting",onChange:B,name:"postBody"}),V&&Object(h.jsx)(u.a,{variant:"danger",className:"mx-2 mt-5",children:"Add text to post"})]}),Object(h.jsx)(d.a,{variant:"info",type:"submit",className:"text-white mt-5",children:f?Object(h.jsxs)("span",{children:[Object(h.jsx)(b.a,{as:"span",size:"sm",animation:"border",role:"status","aria-hidden":"true"}),Object(h.jsx)("span",{className:"mx-1",children:"Creating..."})]}):Object(h.jsx)("span",{children:"Create New Post"})})]})]})]})}}}]);
//# sourceMappingURL=30.9b5a52b5.chunk.js.map